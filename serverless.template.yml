org: {{org}}
app: {{app}}
service: {{service}}

plugins:
  - serverless-plugin-typescript
  - serverless-s3-local
  - serverless-offline
  - serverless-prune-plugin

custom:
  serverless-offline:
    noPrependStageInUrl: true
    noTimeout: true
    port: 3000
    host: localhost
  s3:
    port: 8000
    directory: /tmp
  prune:
    automatic: true
    number: 3
  bucket: {{s3BucketName}}
  
provider:
  name: aws
  runtime: nodejs12.x
  environment: 
    s3Endpoint: {{{s3endpoint}}}
    s3AccessKey: {{s3accessKeyId}}
    s3SecretAccessKey: {{s3secretAccessKey}}
  iamRoleStatements:
  - Effect: Allow
    Action:
      - s3:GetObject
      - s3:PutObject
      - s3:PutObjectAcl
    Resource: 
      - "arn:aws:s3:::${self:custom.bucket}/*"
functions:
  lambdaHandler:
    handler: handlers/lambdaHandler.default
    environment:
      bucket: ${self:custom.bucket}
    events:
      - http:
          path: lambdaHandler/{id}
          method: get
          request:
            parameters:
              paths:
                id: true 
      - s3:
          bucket: ${self:custom.bucket}

